### 两种持久化方式

- RDB方式
- AOF方式

### 持久化使用的方式

- RDB持久化
- AOF持久化
- 无持久化
- 同时使用RDB和AOF

### RDB

##### 优势

- 数据库只包含一个文件，通过文件备份策略，定期配置，恢复系统灾难。
- 容易压缩文件转移到其他介质上。
- 性能最大化，redis开始持久化时，分叉出进程，由子进程完成持久化的工作，避免服务器进程执行I/O操作，启动效率高。

##### 劣势

- 无法高可用：系统一定在定时持久化之前宕机，数据还没写入，数据已经丢失。
- 通过fock分叉子进程完成工作，数据集大的时候，服务器需要停止几百毫秒甚至1秒。

##### 配置

1. 打开redis.conf文件。

```cmd
save 900 1 #每900秒至少1个key变化，持久化一次，到内存一个快照
save 300 10 #每300秒至少10个key变化，往硬盘写一次
save 60 10000 #每60秒至少10000个key变化，写一次
dbfilename dump.rdb #数据的文件名
dir ./ #保存的路径，redis路径下
```

### AOF

##### 优势

- 带来更高的数据安全性
- 同步：
  - 每秒同步：异步完成，效率高，一旦系统宕机，修改的数据丢失
  - 每修改同步：同步持久化，每分钟发生的变化记录到磁盘中，效率低，安全
- 系统宕机，不影响存在的内容
- 写入一半数据，若系统崩溃，下次启动redis，redis-check-aof工具解决数据一致性
- 如果日志过大，自动启动重写机制，修改的数据写入到磁盘文件，创建新文件，记录产生的修改命令，重写切换时，保证数据安全。
- 格式清晰的日志文件，完成数据的重建。

##### 劣势

- 对于相同数量的数据集，相比RDB，AOF文件较大。
- 效率低于RDB。

##### 配置

```cmd
appendonly no #AOF方式默认关闭  
appendfilename appendonly.aof #配置文件
#appendfsync always #每修改一次，同步到磁盘上
appendsync everysec #每秒同步到磁盘一次
#appensync no #不同步
```

